#!/bin/bash

# Path to the CSV file with weather data
DATA_FILE="./data.csv"

# Function to generate an HTML page
generate_html_page() {
    local place="$1"
    local temperature="$2"
    local precipitation="$3"

    cat <<EOF
Content-type: text/html

<!DOCTYPE html>
<html>
<head>
    <title>Weather for $place</title>
</head>
<body>
    <h1>Weather for $place</h1>
    <p>Temperature: $temperatureÂ°C</p>
    <p>Precipitation: $precipitation mm</p>
</body>
</html>
EOF
}

# Extract 'place' parameter from the query string
query_string="\$(printf '%b' "\${QUERY_STRING//%/\\x}")"
place=\$(echo "\$query_string" | sed -n 's/^.*place=\([^&]*\).*$/\1/p')

# Check if place is provided
if [ -z "\$place" ]; then
    echo "Content-type: text/html"
    echo
    echo "<html><body><p>Error: No place specified</p></body></html>"
    exit 1
fi

# Read weather data from the CSV file
while IFS=, read -r name url latitude longitude temperature precipitation
do
    if [ "\$name" == "\$place" ]; then
        generate_html_page "\$name" "\$temperature" "\$precipitation"
        exit 0
    fi
done < "\$DATA_FILE"

# If place not found in the file
echo "Content-type: text/html"
echo
echo "<html><body><p>Place not found: \$place</p></body></html>"
